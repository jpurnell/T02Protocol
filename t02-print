#!/bin/bash
#
# T02 Print Helper Script
# Simple wrapper for printing to Phomemo T02
#

set -e

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

print_usage() {
    cat << EOF
${BLUE}T02 Printer Helper${NC}

Usage:
  ./t02-print <image> [feed_lines]

Examples:
  ./t02-print photo.png           # Print with default feed (4 lines)
  ./t02-print label.png 6         # Print with 6 line feed
  ./t02-print --help              # Show this help

Before printing:
  1. Power cycle your T02 printer (OFF then ON)
  2. Wait 5 seconds
  3. Run this script within 30 seconds

See QUICK_START_T02.md for detailed instructions.
EOF
    exit 0
}

# Check arguments
if [ $# -eq 0 ] || [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
    print_usage
fi

IMAGE="$1"
FEED="${2:-4}"

# Validate image exists
if [ ! -f "$IMAGE" ]; then
    echo -e "${RED}Error: Image file not found: $IMAGE${NC}"
    exit 1
fi

# Print reminder
echo -e "${YELLOW}‚ö° REMINDER:${NC}"
echo -e "   1. Power cycle your T02 printer (OFF then ON)"
echo -e "   2. Wait 5 seconds for it to boot"
echo -e ""
echo -e "${BLUE}Press Enter when ready to print...${NC}"
read

# Run the print tool
cd "$SCRIPT_DIR"
echo -e "${GREEN}üñ®Ô∏è  Printing: $IMAGE${NC}"
echo ""

swift run T02PrintTool bt "$IMAGE" "$FEED"

# Check exit code
if [ $? -eq 0 ]; then
    echo ""
    echo -e "${GREEN}‚úÖ Success! Check your printer.${NC}"
else
    echo ""
    echo -e "${RED}‚ùå Print failed. See error above.${NC}"
    echo -e "${YELLOW}Troubleshooting:${NC}"
    echo -e "   - Try power cycling the printer again"
    echo -e "   - Close the Phomemo app if it's running"
    echo -e "   - Make sure printer is within range"
    exit 1
fi
